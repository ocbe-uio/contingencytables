set.seed(3755232)

context("Output class, name and length")

# Common elements ======================================== #

n <- lampasona_2013
n2 <- peterson_2007
n3 <- lydersen_2012a
n4 <- doll_hill_1950
n5 <- matrix(1:9, 3)
n6 <- matrix(1:8, ncol = 2)
n7 <- floor(lydersen_2012a / 4)

# Unit tests ============================================= #
set.seed(6492798) # useful for functions using Bootstrap
t001 <- Adjusted_inv_sinh_CI_OR_2x2(n)
t002 <- Adjusted_inv_sinh_CI_ratio_2x2(n)
t003 <- Adjusted_log_CI_2x2(n)
t004 <- AgrestiCaffo_CI_2x2(n)
t005 <- AgrestiCoull_CI_1x2(33, 45)
t006 <- BaptistaPike_exact_conditional_CI_2x2(n)
t007 <- BaptistaPike_midP_CI_2x2(n)
t008 <- Bhapkar_test_paired_cxc(n2)
t009 <- Blaker_exact_CI_1x2(13, 16)
t010 <- Blaker_exact_test_1x2(13, 16, .5)
t011 <- Blaker_midP_CI_1x2(13, 16)
t012 <- Arcsine_CI_1x2(13, 16)
t013 <- Blaker_midP_test_1x2(13, 16, .5)
t014 <- BonettPrice_hybrid_Wilson_score_CI_CC_paired_2x2(n)
t015 <- BonettPrice_hybrid_Wilson_score_CI_paired_2x2(n)
t016 <- Bonferroni_type_CIs_paired_cxc(n)
t017 <- Bonferroni_type_CIs_rxc(n)
t018 <- Brant_test_2xc(n3)
t019 <- BreslowDay_homogeneity_test_stratified_2x2(n4)
t020 <- Chacko_test_1xc(n)
t021 <- ClopperPearson_exact_CI_1x2_beta_version(13, 16)
t022 <- ClopperPearson_exact_CI_1x2(13, 16)
t023 <- ClopperPearson_midP_CI_1x2(13, 16)
t024 <- Cochran_Q_test_stratified_2x2(n4)
t025 <- CochranArmitage_CI_rx2(n, 1:2)
t026 <- CochranArmitage_exact_cond_midP_tests_rx2(n2, 1:4)
t027 <- CochranArmitage_MH_tests_rx2(n2, 1:4)
t028 <- CochranMantelHaenszel_test_stratified_2x2(n4)
t029 <- Cornfield_exact_conditional_CI_2x2(n)
t030 <- Cornfield_midP_CI_2x2(n)
t031 <- Cumulative_models_for_2xc(n3)
t032 <- Cumulative_models_for_rxc(n3)
t033 <- Exact_binomial_test_1x2(13, 16, .5)
t034 <- Exact_cond_midP_linear_rank_tests_2xc(n5)
t035 <- Exact_cond_midP_tests_rxc(n5[, 1:2])
t036 <- Exact_cond_midP_unspecific_ordering_rx2(n6, "decreasing")
t037 <- Exact_multinomial_test_1xc(1:3, seq(.4, .6, .1))
t038 <- Exact_unconditional_test_2x2(n)
t039 <- Fisher_exact_test_2x2(n)
t040 <- t038
t041 <- Fisher_midP_test_2x2(n)
t042 <- FisherFreemanHalton_asymptotic_test_rxc(n)
t043 <- FleissEveritt_test_paired_cxc(n5)
t044 <- FleissLevinPaik_test_paired_cxc(n5)
t045 <- gamma_coefficient_rxc_bca(n, nboot = 160)
t046 <- gamma_coefficient_rxc(n)
t047 <- Gart_adjusted_logit_CI_2x2(n)
t048 <- Gold_Wald_CIs_1xc(n)
t049 <- Goodman_Wald_CIs_1xc(n)
t050 <- Goodman_Wald_CIs_for_diffs_1xc(n)
t051 <- Goodman_Wilson_score_CIs_1xc(n)
t052 <- Independence_smoothed_logit_CI_2x2(n)
t053 <- Inv_sinh_CI_OR_2x2(n)
t054 <- Inv_sinh_CI_ratio_2x2(n)
t055 <- InverseVariance_estimate_stratified_2x2(n4)
t056 <- Jeffreys_CI_1x2(13, 16)
t057 <- JonckheereTerpstra_test_rxc(n)
t058 <- Katz_log_CI_2x2(n)
t059 <- Kendalls_tau_b_rxc_bca(n, nboot = 160)
t060 <- Kendalls_tau_b_rxc(n)
t061 <- Koopman_asymptotic_score_CI_2x2(n)
t062 <- KruskalWallis_asymptotic_test_rxc(n)
t063 <- linear_by_linear_test_rxc(n)
t064 <- LR_CI_1x2(13, 16)
t065 <- LR_test_1x2(13, 16, .3)
t066 <- LR_test_1xc(1:3, c(.3, .5, .1))
t067 <- LR_test_2x2(n)
t068 <- MantelHaenszel_estimate_stratified_2x2(n4)
t069 <- MantelHaenszel_test_2xc(n)
t070 <- McNemar_asymptotic_test_CC_paired_2x2(n)
t071 <- McNemar_asymptotic_test_paired_2x2(n)
t072 <- McNemar_exact_cond_test_paired_2x2(n2)
t073 <- McNemar_exact_unconditional_test_paired_2x2(n)
t074 <- McNemar_midP_test_paired_2x2(n)
t075 <- McNemarBowker_test_paired_cxc(n)
t076 <- Mee_asymptotic_score_CI_2x2(n)
t077 <- MidP_binomial_test_1x2(13, 16, .3)
t078 <- MidP_multinomial_test_1xc(n, runif(4))
t079 <- MiettinenNurminen_asymptotic_score_CI_difference_2x2(n)
t080 <- MiettinenNurminen_asymptotic_score_CI_OR_2x2(n)
t081 <- MiettinenNurminen_asymptotic_score_CI_ratio_2x2(n)
t082 <- ML_estimates_and_CIs_stratified_2x2(n4)
t083 <- MOVER_R_Wilson_CI_OR_2x2(n)
t084 <- MOVER_R_Wilson_CI_ratio_2x2(n)
t085 <- MOVER_Wilson_score_CI_paired_2x2(n)
t086 <- Newcombe_hybrid_score_CI_2x2(n)
t087 <- Newcombe_square_and_add_CI_paired_2x2(n)
t088 <- Pearson_chi_squared_test_1xc(n, runif(4))
t089 <- Pearson_chi_squared_test_2x2(n)
t090 <- Pearson_chi_squared_test_CC_2x2(n)
t091 <- Pearson_correlation_coefficient_rxc_bca(n, nboot = 160)
t092 <- Pearson_correlation_coefficient_rxc(n)
t093 <- Pearson_LR_homogeneity_test_stratified_2x2(n4)
t094 <- Pearson_LR_test_common_effect_stratified_2x2(n4)
t095 <- Pearson_LR_tests_cum_OR_2xc(n)
t096 <- Pearson_LR_tests_rxc(n)
t097 <- Pearson_LR_tests_unspecific_ordering_rx2(n, "increasing")
t098 <- Pearson_residuals_rxc(n)
t099 <- Peto_homogeneity_test_stratified_2x2(n4)
t100 <- Peto_OR_estimate_stratified_2x2(n4)
t101 <- PriceBonett_approximate_Bayes_CI_2x2(n)
t102 <- QuesenberryHurst_Wilson_score_CIs_1xc(n)
t103 <- RBG_test_and_CI_stratified_2x2(n4)
t104 <- Scheffe_type_CIs_paired_cxc(n)
t105 <- Scheffe_type_CIs_rxc(n)
t106 <- Score_test_1x2(13, 16, .5)
t107 <- Score_test_and_CI_marginal_mean_scores_paired_cxc(n, runif(4))
t108 <- Score_test_CC_1x2(13, 16, .5)
t109 <- Score_test_for_effect_in_the_probit_model_2xc(n, rnorm(4))
t110 <- Spearman_correlation_coefficient_rxc_bca(n, nboot = 160)
t111 <- Spearman_correlation_coefficient_rxc(n)
t112 <- invisible(capture.output(stratified_2x2_tables(n4)))
t113 <- Stuart_test_paired_cxc(n2, printresults = FALSE)
t114 <- Tang_asymptotic_score_CI_paired_2x2(n, printresults = FALSE)
t115 <- Tango_asymptotic_score_CI_paired_2x2(n, printresults = FALSE)
t116 <- invisible(capture.output(the_1x2_table_CIs(13, 16)))
t117 <- invisible(capture.output(the_1x2_table_tests(13, 16, .4)))
t118 <- invisible(capture.output(the_1xc_table_CIs(n)))
t119 <- invisible(capture.output(the_1xc_table_tests(n, runif(4))))
t120 <- invisible(capture.output(the_2x2_table_CIs_difference(n)))
t121 <- invisible(capture.output(the_2x2_table_CIs_OR(n)))
t122 <- invisible(capture.output(the_2x2_table_CIs_ratio(n)))
t123 <- invisible(capture.output(the_2x2_table_tests(n)))
t124 <- invisible(capture.output(the_2xc_table(n7, direction = "decreasing")))
t125 <- invisible(capture.output(the_paired_2x2_table_CIs_difference(n)))
t126 <- invisible(capture.output(the_paired_2x2_table_CIs_OR(n)))
t127 <- invisible(capture.output(the_paired_2x2_table_CIs_ratio(n)))
t128 <- invisible(capture.output(the_paired_2x2_table_tests(n)))
t129 <- invisible(capture.output(the_paired_cxc_table_nominal(n)))
t130 <- invisible(capture.output(the_paired_cxc_table_ordinal(n, rnorm(4))))
t131 <- invisible(capture.output(the_rx2_table(n2, skip_exact = TRUE)))
t132 <- invisible(capture.output(the_rxc_table(n2, nboot = 0)))
t133 <- Transformed_Blaker_exact_CI_paired_2x2(n, printresults = FALSE)
t134 <- Transformed_Clopper_Pearson_exact_CI_paired_2x2(n, printresults = FALSE)
t135 <- Transformed_Clopper_Pearson_midP_CI_paired_2x2(n, printresults = FALSE)
t136 <- Transformed_Wilson_score_CI_paired_2x2(n, printresults = FALSE)
t137 <- Trend_estimate_CI_tests_rx2(n, 1:2, printresults = FALSE)
t138 <- Uncorrected_asymptotic_score_CI_2x2(n, printresults = FALSE)
t139 <- Wald_CI_1x2(13, 16, printresults = FALSE)
t140 <- Wald_CI_2x2(n, printresults = FALSE)
t141 <- Wald_CI_AgrestiMin_paired_2x2(n, printresults = FALSE)
t142 <- Wald_CI_BonettPrice_paired_2x2(n, printresults = FALSE)
t143 <- Wald_CI_CC_1x2(13, 16, printresults = FALSE)
t144 <- Wald_CI_CC_2x2(n, printresults = FALSE)
t145 <- Wald_CI_diff_CC_paired_2x2(n, printresults = FALSE)
t146 <- Wald_CI_diff_paired_2x2(n, printresults = FALSE)
t147 <- Wald_CI_OR_Laplace_paired_2x2(n, printresults = FALSE)
t148 <- Wald_CI_OR_paired_2x2(n, printresults = FALSE)
t149 <- Wald_CI_ratio_paired_2x2(n, printresults = FALSE)
t150 <- Wald_test_1x2(13, 16, .1, printresults = FALSE)
t151 <- Wald_test_and_CI_common_diff_stratified_2x2(n4, printresults = FALSE)
t152 <- Wald_test_and_CI_common_ratio_stratified_2x2(n4, printresults = FALSE)
t153 <- Wald_test_and_CI_marginal_mean_ranks_paired_cxc(n, printresults = FALSE)
t154 <- Wald_test_and_CI_marginal_mean_scores_paired_cxc(
  n, rnorm(4), printresults = FALSE
)
t155 <- Wald_test_CC_1x2(13, 16, .1, printresults = FALSE)
t156 <- Wilson_score_CI_1x2(13, 16, printresults = FALSE)
t157 <- Wilson_score_CI_CC_1x2(13, 16, printresults = FALSE)
t158 <- Woolf_logit_CI_2x2(n, printresults = FALSE)
t159 <- Woolf_test_and_CI_stratified_2x2(n4, printresults = FALSE)
t160 <- Z_unpooled_test_2x2(n, printresults = FALSE)

function_output_objects <- ls(pattern = "t\\d{3}")

test_that("Output class and names are the expected", {
  for (t in function_output_objects[c(1:111)]) {
    expect_is(get(t), "contingencytables_result")
    expect_named(get(t), c("statistics", "print_format"))
    # TODO: test that statistics is consistent. Currently, some are lists, others are data.frame and vectors
  }
})

test_that("Output classes are the expected", {
  expect_is(t112, "character")
  expect_is(t113, "list")
  expect_is(t114, "list")
  expect_is(t115, "list")
  expect_is(t116, "character")
  expect_is(t117, "character")
  expect_is(t118, "character")
  expect_is(t119, "character")
  expect_is(t120, "character")
  expect_is(t121, "character")
  expect_is(t122, "character")
  expect_is(t123, "character")
  expect_is(t124, "character")
  expect_is(t125, "character")
  expect_is(t126, "character")
  expect_is(t127, "character")
  expect_is(t128, "character")
  expect_is(t129, "character")
  expect_is(t130, "character")
  expect_is(t131, "character")
  expect_is(t132, "character")
  expect_is(t133, "list")
  expect_is(t134, "list")
  expect_is(t135, "list")
  expect_is(t136, "list")
  expect_is(t137, "list")
  expect_is(t138, "data.frame")
  expect_is(t139, "numeric")
  expect_is(t140, "data.frame")
  expect_is(t141, "list")
  expect_is(t142, "list")
  expect_is(t143, "numeric")
  expect_is(t144, "data.frame")
  expect_is(t145, "list")
  expect_is(t146, "list")
  expect_is(t147, "list")
  expect_is(t148, "list")
  expect_is(t149, "list")
  expect_is(t150, "numeric")
  expect_is(t151, "list")
  expect_is(t152, "list")
  expect_is(t153, "list")
  expect_is(t154, "list")
  expect_is(t155, "numeric")
  expect_is(t156, "numeric")
  expect_is(t157, "numeric")
  expect_is(t158, "data.frame")
  expect_is(t159, "list")
  expect_is(t160, "data.frame")
})

test_that("Output names are the expected", {
  lue <- c("lower", "upper", "estimate")
  ptdf <- c("P", "T", "df")
  LUe <- c("L", "U", "estimate")
  LUdelta <- c("L", "U", "deltahat")
  LUdiff <- c("L", "U", "differences")
  luee <- c("lower", "upper", "estimate.1", "estimate.2")
  pz <- c("P", "Z")
  psdf <- c("p.value", "statistic", "df")
  rplu <- c("rP", "L", "U")
  plr_df <- c("P_LR", "T_LR", "df_LR", "P_Pearson", "T_Pearson", "df_Pearson")
  plr <- c("T_Pearson", "P_Pearson", "T_LR", "P_LR")
  ps <- c("p.value", "statistic")
  expect_named(t112, NULL)
  expect_named(t113, c("P", "T0", "df"))
  expect_named(t114, LUe)
  expect_named(t115, LUe)
  expect_named(t116, NULL)
  expect_named(t117, NULL)
  expect_named(t118, NULL)
  expect_named(t119, NULL)
  expect_named(t120, NULL)
  expect_named(t121, NULL)
  expect_named(t122, NULL)
  expect_named(t123, NULL)
  expect_named(t124, NULL)
  expect_named(t125, NULL)
  expect_named(t126, NULL)
  expect_named(t127, NULL)
  expect_named(t128, NULL)
  expect_named(t129, NULL)
  expect_named(t130, NULL)
  expect_named(t131, NULL)
  expect_named(t132, NULL)
  expect_named(t133, LUe)
  expect_named(t134, LUe)
  expect_named(t135, LUe)
  expect_named(t136, LUe)
  expect_named(
    t137,
    c(
      "betahat", "Z_Wald", "P_Wald", "T_LR", "P_LR", "df_LR", "chi2", "P_chi2",
      "df_chi2", "D", "P_D", "df_D", "CI_Wald", "CI_Wald_width"
    )
  )
  expect_named(t138, lue)
  expect_named(t139, lue)
  expect_named(t140, lue)
  expect_named(t141, LUe)
  expect_named(t142, LUe)
  expect_named(t143, lue)
  expect_named(t144, lue)
  expect_named(t145, LUe)
  expect_named(t146, LUe)
  expect_named(t147, LUe)
  expect_named(t148, LUe)
  expect_named(t149, LUe)
  expect_named(t150, ps)
  expect_named(t151, c("P", "Z", "L", "U", "deltahat"))
  expect_named(t152, c("P", "Z", "L", "U", "phihat"))
  expect_named(
    t153,
    c(
      "tauhat", "SE_tau", "CI_tau", "Z_Wald", "P", "alphahat", "SE_alpha",
      "CI_alpha", "CI_alpha_logit", "Z_Wald_logit", "P_logit", "CI_tau_logit"
    )
  )
  expect_named(t154, c("P", "Z_Wald", LUe))
  expect_named(t155, ps)
  expect_named(t156, lue)
  expect_named(t157, lue)
  expect_named(t158, lue)
  expect_named(t159, c("P", "Z", "L", "U", "thetahatIV"))
  expect_named(t160, ps)
})
